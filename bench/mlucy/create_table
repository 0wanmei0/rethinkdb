#!/bin/bash
. `cd -P -- "$(dirname $0)" && pwd -P`/init.sh

poc=$1
offset=$2
staging=$3
table=$4
shards=$5
conf=$6

splits=`gen_splits $shards`
conf=`eval 'cat<<EOF
create database \${table}_db
create table $table --database ${table}_db
split shard $table $splits
'"$conf"'
EOF'`

echo "Creating and configuring table:" >&2
awk '{print "  "$0}' >&2 <<EOF
$conf
EOF

admin $poc $offset $staging >$table.1.log 2>$table.2.log <<EOF
$conf
EOF

succ=$?
if [[ $succ != 0 ]]; then
    echo "ERROR CREATING TABLE:"
    cat $table.1.log
    echo "---"
    cat $table.2.log
    exit $succ
fi

