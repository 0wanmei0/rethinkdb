### Steps For Migrating Your Cluster

1. Run `import_export.rb --export --host HOST --port PORT`, where HOST:PORT
connects to a machine in your cluster.  This will write everything in your
cluster to disk, so make sure you have enough space.

2. Upgrade RethinkDB on all your servers, then move or delete all your
`rethinkdb_data` directories (they are incompatible with the new version).

3. Run `import_export.rb --import --host HOST --port PORT`.  This will re-import
all the data on disk into your cluster.  You must run this in the same directory
you ran the `import_export.rb --export` command, or else specify the directory
to read from with `import_export.rb --import DIR`.  You will also have to
specify the directory if you exported from more than one RethinkDB cluster. **
NOTE: If any of your tables have a nonstandard primary key (anything except
`id`), you need to tell the script about the nonstandard keys while importing.
(We stupidly forgot to build a way to fetch the primary key of a table into the
original RDB protocol; this will be fixed in future versions.)  You can specify
this with the `--primary-keys` option, which takes a JSON document of the form
`{"db_name.table_name": "key_name, ...}`. **

### Simple Example

Alice is running a single RethinkDB server on localhost with the default ports.
She does the following:

```
~ $ mkdir rethinkdb_migration
~ $ cd rethinkdb_migration
~/rethinkdb_migration $ wget http://raw.github.com/rethinkdb/rethinkdb/ql-refactor/scripts/migration/import_export.rb
~/rethinkdb_migration $ chmod a+x import_export.rb
~/rethinkdb_migration $ ./import_export.rb  --export
2013-03-14T20:49:59-07:00 Exporting to rethinkdb_export_2013-03-14T20:49:59-07:00_23642...
2013-03-14T20:49:59-07:00 Connecting to localhost:28015...
2013-03-14T20:49:59-07:00 Connected with query language Query_Language_1...
2013-03-14T20:49:59-07:00 Exporting database test3...
2013-03-14T20:49:59-07:00 Exporting database test...
2013-03-14T20:49:59-07:00 Exporting table test.test2...
2013-03-14T20:49:59-07:00 Exporting table test.foo...
2013-03-14T20:49:59-07:00 Exporting table test.test...
2013-03-14T20:49:59-07:00 Exporting database test2...
2013-03-14T20:49:59-07:00 Exporting table test2.abc...
2013-03-14T20:49:59-07:00 Done!
~/rethinkdb_migration $ <SHUT DOWN RETHINKDB>
~/rethinkdb_migration $ <MOVE/DELETE RETHINKDB_DATA DIRECTORY>
~/rethinkdb_migration $ <UPGRADE RETHINKDB>
~/rethinkdb_migration $ <RESTART RETHINKDB>
~/rethinkdb_migration $ ./import_export.rb --import
2013-03-14T20:50:31-07:00 No directory specified, defaulting to `rethinkdb_export_2013-03-14T20:49:59-07:00_23642`.
2013-03-14T20:50:31-07:00 Importing from rethinkdb_export_2013-03-14T20:49:59-07:00_23642...
2013-03-14T20:50:31-07:00 Connecting to localhost:28015...
2013-03-14T20:50:31-07:00 Connected with query language Query_Language_2...
2013-03-14T20:50:31-07:00 Importing database test3...
2013-03-14T20:50:31-07:00 Importing database test...
2013-03-14T20:50:31-07:00 Importing table test.test2 with primary key id...
2013-03-14T20:50:31-07:00 Importing table test.foo with primary key id...
2013-03-14T20:50:31-07:00 Importing table test.test with primary key id...
2013-03-14T20:50:31-07:00 Importing database test2...
2013-03-14T20:50:31-07:00 Importing table test2.abc with primary key id...
2013-03-14T20:50:32-07:00 Done!
~/rethinkdb_migration $
```