desc: sindex api (#602)
tests:

  - cd: r.db('test').table_create('sindex_api')
    def: tbl = r.table('sindex_api')

  - rb: tbl.insert([{:id => 0, :a => 0, :b => 0, :c => 0},
                    {:id => 1, :a => 0, :b => 0, :c => 0},
                    {:id => 2, :a => 0, :b => 0, :c => 1},
                    {:id => 3, :a => 0, :b => 1, :c => 1}])
    ot: ({'deleted':0,'inserted':4,'skipped':0,'errors':0,'replaced':0,'unchanged':0})

  - rb: tbl.index_create('ai') {|row| row[:a]}
    ot: ({'created':1})
  - rb: tbl.index_create('ai') {|row| row[:a]}
    ot: 'err("RqlRuntimeError", "Index `ai` already exists.", [])'
  - rb: tbl.index_create('bi') {|row| row[:b]}
    ot: ({'created':1})
  - rb: tbl.index_create('ci') {|row| row[:c]}
    ot: ({'created':1})
  - rb: tbl.index_create('idi') {|row| row[:id]}
    ot: ({'created':1})
  - rb: tbl.index_create('brokeni') {|row| row[:broken]}
    ot: ({'created':1})

  - rb: tbl.get(true)
    ot: 'err("RqlRuntimeError", "Primary keys must be either a number or a string (got true of type BOOL).", [])'
  - rb: tbl.get([])
    ot: 'err("RqlRuntimeError", "Primary keys must be either a number or a string (got [] of type ARRAY).", [])'
  - rb: tbl.get(-1)
    ot: nil
  - rb: tbl.get(1)[:id]
    ot: 1
  - rb: tbl.get(1).typeof
    ot: ('SINGLE_SELECTION')
  - rb: tbl.get(1).update{nil}
    ot: ({'replaced':0,'skipped':0,'deleted':0,'unchanged':1,'errors':0,'inserted':0})
  - rb: tbl.get(1, :ai)
    ot: 'err("RqlCompileError", "Expected 2 argument(s) but found 3.", [])'

  - rb: tbl.get_all(true)
    ot: 'err("RqlRuntimeError", "Primary keys must be either a number or a string (got true of type BOOL).", [])'
  - rb: tbl.get_all(-1)
    ot: []
  - rb: tbl.get_all(1)[0][:id]
    ot: 1
  - rb: tbl.get_all(1).typeof
    ot: ('SELECTION')
  - rb: tbl.get_all(1).update{nil}
    ot: ({'replaced':0,'skipped':0,'deleted':0,'unchanged':1,'errors':0,'inserted':0})

  - rb: tbl.get_all(0, :index => :fake)
    ot: 'err("RqlRuntimeError", "Index `fake` was not found.", [])'
  - rb: tbl.get_all(0, :index => false)
    ot: 'err("RqlRuntimeError", "Expected type STRING but found BOOL.", [])'

  - rb: tbl.get_all(true, :index => :id)
    ot: 'err("RqlRuntimeError", "Primary keys must be either a number or a string (got true of type BOOL).", [])'
  - rb: tbl.get_all([], :index => :id)
    ot: 'err("RqlRuntimeError", "Primary keys must be either a number or a string (got [] of type ARRAY).", [])'
  - rb: tbl.get_all(true, :index => :idi)
    ot: 'err("RqlRuntimeError", "Secondary keys must be a number, string, or array (got true of type BOOL).", [])'
  - rb: tbl.get_all([], :index => :idi)
    ot: []

  - rb: tbl.get_all(1, :index => :id)[0][:id]
    ot: 1
  - rb: tbl.get_all(1, :index => :idi)[0][:id]
    ot: 1
  - rb: tbl.get_all(1, :index => :ai)
    ot: []
  - rb: tbl.get_all(1, :index => :bi).orderby(:id).map{|x| x[:id]}
    ot: [3]
  - rb: tbl.get_all(1, :index => :ci).orderby(:id).map{|x| x[:id]}
    ot: [2, 3]
  - rb: tbl.get_all(1, :index => :ci).typeof
    ot: ('SELECTION')
  - rb: tbl.get_all(1, :index => :ci).update{nil}
    ot: ({'replaced':0,'skipped':0,'deleted':0,'unchanged':2,'errors':0,'inserted':0})
  - rb: tbl.get_all(1, :index => :brokeni)
    ot: []

  - rb: tbl.eq_join(:id, tbl, :index => :fake)
    ot: 'err("RqlRuntimeError", "Index `fake` was not found.", [])'
  - rb: tbl.eq_join(:id, tbl, :index => false)
    ot: 'err("RqlRuntimeError", "Expected type STRING but found BOOL.", [])'

  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl)
    ot: ([{'left':{'a':0,'b':0,'c':0,'id':0},'right':{'a':0,'b':0,'c':0,'id':0}}])
  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl, :index => :id)
    ot: ([{'left':{'a':0,'b':0,'c':0,'id':0},'right':{'a':0,'b':0,'c':0,'id':0}}])
  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl, :index => :idi)
    ot: ([{'left':{'a':0,'b':0,'c':0,'id':0},'right':{'a':0,'b':0,'c':0,'id':0}}])
  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl, :index => :ai).orderby(:right)
    ot: [{'right':{'id':0,'a':0,'b':0,'c':0},'left':{'id':0,'a':0,'b':0,'c':0}},
         {'right':{'id':1,'a':0,'b':0,'c':0},'left':{'id':0,'a':0,'b':0,'c':0}},
         {'right':{'id':2,'a':0,'b':0,'c':1},'left':{'id':0,'a':0,'b':0,'c':0}},
         {'right':{'id':3,'a':0,'b':1,'c':1},'left':{'id':0,'a':0,'b':0,'c':0}}]
  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl, :index => :bi).orderby(:right)
    ot: [{'right':{'id':0,'a':0,'b':0,'c':0},'left':{'id':0,'a':0,'b':0,'c':0}},
         {'right':{'id':1,'a':0,'b':0,'c':0},'left':{'id':0,'a':0,'b':0,'c':0}},
         {'right':{'id':2,'a':0,'b':0,'c':1},'left':{'id':0,'a':0,'b':0,'c':0}}]
  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl, :index => :ci).orderby(:right)
    ot: [{'right':{'id':0,'a':0,'b':0,'c':0},'left':{'id':0,'a':0,'b':0,'c':0}},
         {'right':{'id':1,'a':0,'b':0,'c':0},'left':{'id':0,'a':0,'b':0,'c':0}}]
  - rb: tbl.filter({:id => 0}).eq_join(:id, tbl, :index => :brokeni)
    ot: []

  - rb: tbl.eq_join(:c, tbl, :index => :bi).orderby(:right, :left)
    ot: ([{'left':{'id':0,'a':0,'b':0,'c':0},'right':{'id':0,'a':0,'b':0,'c':0}},
          {'left':{'id':1,'a':0,'b':0,'c':0},'right':{'id':0,'a':0,'b':0,'c':0}},
          {'left':{'id':0,'a':0,'b':0,'c':0},'right':{'id':1,'a':0,'b':0,'c':0}},
          {'left':{'id':1,'a':0,'b':0,'c':0},'right':{'id':1,'a':0,'b':0,'c':0}},
          {'left':{'id':0,'a':0,'b':0,'c':0},'right':{'id':2,'a':0,'b':0,'c':1}},
          {'left':{'id':1,'a':0,'b':0,'c':0},'right':{'id':2,'a':0,'b':0,'c':1}},
          {'left':{'id':2,'a':0,'b':0,'c':1},'right':{'id':3,'a':0,'b':1,'c':1}},
          {'left':{'id':3,'a':0,'b':1,'c':1},'right':{'id':3,'a':0,'b':1,'c':1}}])

  - rb: tbl.index_create('id')
    ot: 'err("RqlRuntimeError", "Index name conflict: `id` is the name of the primary key.", [])'

  - rb: tbl.index_create('c')
    ot: ({'created':1})
  - rb: tbl.index_create('broken')
    ot: ({'created':1})

  - rb: tbl.get_all(1, :index => 'c').orderby(:id).map{|x| x[:id]}
    ot: [2, 3]
  - rb: tbl.get_all(1, :index => 'broken').orderby(:broken).map{|x| x[:id]}
    ot: []

  - rb: tbl.index_create('nil') {nil}
    ot: ({'created':1})
  - rb: tbl.get_all(nil, :index => :nil)
    ot: 'err("RqlRuntimeError", "Secondary keys must be a number, string, or array (got nu""ll of type NULL).", [])'

  - cd: r.db('test').table_drop('sindex_api')