for (mode, checker) in [
        ("debug", "valgrind"),
        ("release", "valgrind"),
        ("release", None),
# Don't run the corruption test in mockcache mode because in that modes
# we don't flush to disk at all until the server is shut down, so obviously the
# corruption test will fail.
#        ("debug-mockcache", "valgrind"),
        ("debug-noepoll", "valgrind")]:
    for protocol in ["text"]: # ["text", "binary"]:
        for (cores, slices) in [(1, 1), (2, 8)]:
            for dur in [2, 5, 10, 60, 300, 420]:
                do_test_fog("integration/corruption.py",
                            { "auto"          : True,
                              "mode"          : mode,
                              "no-valgrind"   : not checker,
                              "protocol"      : protocol,
                              "cores"         : cores,
                              "slices"        : slices,
                              "duration"      : dur,
                              "verify-timeout": dur * 5 * ec2 + 740 },
                            repeat=2, timeout=dur * 5 * ec2 + 740)

