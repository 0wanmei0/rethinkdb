for (mode, checker) in [
        ("debug", "valgrind"),
        ("release", None)]:
    for protocol in ["text"]:
        for (cores, slices) in [(2, 8)]:
            # Run a canonical workload for half hour
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 1800,
                          "fsck"        : False},
                        repeat=2, timeout=2400 * ec2)

            # Run an modify-heavy workload for half hour
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 1800,
                          "ndeletes"    : 1,
                          "nupdates"    : 5,
                          "ninserts"    : 10,
                          "nreads"      : 1,
                          "fsck"        : False},
                        repeat=2, timeout=2400)

            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 1800,
                          "memory"      : 1000,
                          "mem-cap"     : 1200,
                          "ndeletes"    : 0,
                          "nupdates"    : 0,
                          "ninserts"    : 1,
                          "nreads"      : 0,
                          "fsck"        : False,
                          #"min-qps"     : 20 # a very reasonable limit #this is temporarily disabled because cmd_set_persec isn't available on servers
                          },
                        repeat=2, timeout=2400)

            # Run a canonical + rget workload for twenty minutes
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 1200,
                          "nrgets"      : 1,
                          "fsck"        : False},
                        repeat=2, timeout=2400 * ec2)

            # Run a canonical + rget workload for twenty minutes under memory pressure
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "memory"      : 8,
                          "diff-log-size" : 4,
                          "duration"    : 1200,
                          "nrgets"      : 1,
                          "fsck"        : False},
                        repeat=2, timeout=2400 * ec2)

