for (mode, checker) in [
        ("debug", "valgrind"),
        ("release", None)]:
    for protocol in ["text"]:
        for (cores, slices) in [(2, 8)]:
            # Test different command line configurations (defaults less thoroughly)
            # (originally added by Daniel Mewes)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "restart-server-prob" : "0.002",
                          "serve-flags" : "--read-ahead y"},
                                repeat=3, timeout=300)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "restart-server-prob" : "0.002",
                          "serve-flags" : "--read-ahead n"},
                                repeat=1, timeout=300)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "restart-server-prob" : "0.002",
                          "serve-flags" : "--flush-concurrency 20 --flush-timer 500"},
                                repeat=3, timeout=300)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "restart-server-prob" : "0.002",
                          "serve-flags" : "--flush-concurrency 1 --flush-timer 500"},
                                repeat=1, timeout=300)
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "serve-flags" : "--flush-concurrency 20 --flush-timer 500",
                          "fsck"        : False},
                        repeat=3, timeout=300 * ec2)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "restart-server-prob" : "0.002",
                          "serve-flags" : "--io-backend pool"},
                                repeat=3, timeout=300)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "restart-server-prob" : "0.002",
                          "serve-flags" : "--io-backend native"},
                                repeat=1, timeout=300)
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "serve-flags" : "--io-backend pool",
                          "fsck"        : False},
                        repeat=3, timeout=300 * ec2)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "diff-log-size" : 0,
                          "restart-server-prob" : "0.002"},
                                repeat=3, timeout=300)
            do_test_fog("integration/serial_mix.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "diff-log-size" : 8,
                          "restart-server-prob" : "0.002"},
                                repeat=1, timeout=300)
            do_test_fog("integration/stress_load.py",
                        { "auto"        : True,
                          "mode"        : mode,
                          "no-valgrind" : not checker,
                          "protocol"    : protocol,
                          "cores"       : cores,
                          "slices"      : slices,
                          "duration"    : 180,
                          "diff-log-size" : 0,
                          "fsck"        : False},
                        repeat=3, timeout=300 * ec2)

